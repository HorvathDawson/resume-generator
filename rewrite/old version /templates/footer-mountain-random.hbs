<footer class="footer-mountain-random">
    <div class="mountains-container" data-mountain-container="true">
        <!-- Mountains will be generated by JavaScript -->
    </div>
    <script>
        (function() {
            // Simple seeded random number generator (Linear Congruential Generator)
            function SeededRandom(seed) {
                this.seed = seed % 2147483647;
                if (this.seed <= 0) this.seed += 2147483646;
            }
            
            SeededRandom.prototype.next = function() {
                this.seed = this.seed * 16807 % 2147483647;
                return (this.seed - 1) / 2147483646;
            };
            
            // Get page number from various possible sources
            function getPageNumber() {
                // Method 1: Find which page element contains this footer
                const scriptElement = document.currentScript;
                const footer = scriptElement ? scriptElement.closest('footer') : null;
                
                if (footer) {
                    const pageElements = document.querySelectorAll('page, .page');
                    for (let i = 0; i < pageElements.length; i++) {
                        if (pageElements[i].contains(footer)) {
                            return i + 1;
                        }
                    }
                }
                
                // Method 2: Count existing mountain containers to determine page
                const mountainContainers = document.querySelectorAll('[data-mountain-container="true"]');
                let currentIndex = 0;
                for (let i = 0; i < mountainContainers.length; i++) {
                    if (mountainContainers[i].closest('footer') === footer) {
                        currentIndex = i;
                        break;
                    }
                }
                return currentIndex + 1;
            }
            
            function generateRandomMountains() {
                // Find the container for this specific script instance
                const scriptElement = document.currentScript;
                const footer = scriptElement ? scriptElement.closest('footer') : null;
                const container = footer ? footer.querySelector('[data-mountain-container="true"]') : null;
                
                if (!container) {
                    console.warn('Mountain Random Footer: Could not find container');
                    return;
                }
                
                // Get seed from template data or use page-based seed
                const customSeed = {{#if customSeed}}{{customSeed}}{{else}}null{{/if}};
                const pageNumber = getPageNumber();
                
                let baseSeed;
                if (customSeed !== null) {
                    // Use custom seed + page number for variation per page
                    baseSeed = parseInt(customSeed) + pageNumber * 1000;
                } else {
                    // Use default page-based seed
                    baseSeed = pageNumber * 12345 + 67890;
                }
                
                const rng = new SeededRandom(baseSeed);
                
                // Generate 3-6 mountains randomly
                const numMountains = Math.floor(rng.next() * 4) + 3; // 3-6 mountains
                
                const colors = [
                    'var(--highlight-color)',
                    'var(--right-text-color)',
                    'var(--left-accent-color, var(--highlight-color))',
                    'var(--text-color, #333333)'
                ];
                
                const pageWidth = 19; // A4 width minus margins in cm
                const usedPositions = [];
                
                for (let i = 0; i < numMountains; i++) {
                    // Random properties with seed
                    const width = rng.next() * 2 + 0.8; // 0.8-2.8cm width
                    const height = rng.next() * 1.6 + 0.6; // 0.6-2.2cm height
                    const opacity = rng.next() * 0.4 + 0.4; // 0.4-0.8 opacity
                    const colorIndex = Math.floor(rng.next() * colors.length);
                    
                    // Find a position that doesn't overlap too much
                    let position;
                    let attempts = 0;
                    do {
                        position = rng.next() * (pageWidth - width * 2); // Leave space for mountain width
                        attempts++;
                    } while (attempts < 15 && usedPositions.some(pos => Math.abs(pos - position) < width * 1.2));
                    
                    usedPositions.push(position);
                    
                    const mountain = document.createElement('div');
                    mountain.className = `mountain mountain-random-${i}`;
                    mountain.style.cssText = `
                        position: absolute;
                        bottom: 0;
                        left: ${position}cm;
                        width: 0;
                        height: 0;
                        border-left: ${width}cm solid transparent;
                        border-right: ${width}cm solid transparent;
                        border-bottom: ${height}cm solid ${colors[colorIndex]};
                        opacity: ${opacity};
                        z-index: ${Math.floor(rng.next() * 3) + 1};
                    `;
                    
                    container.appendChild(mountain);
                }
                
                // Debug info for development
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    const seedInfo = customSeed !== null ? `custom seed ${customSeed}` : 'page-based seed';
                    console.log(`Mountain Random Footer: Generated ${numMountains} mountains for page ${pageNumber} using ${seedInfo} (final seed: ${baseSeed})`);
                }
            }
            
            // Generate mountains immediately since script is inline
            generateRandomMountains();
        })();
    </script>
</footer>
</body>
</html>
