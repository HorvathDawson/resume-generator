<footer class="footer-mountains-random">
    <div class="mountains-container" data-mountain-container="true">
        <!-- Mountains will be generated by JavaScript -->
    </div>
    <script>
        (function() {
            // Simple seeded random number generator (Linear Congruential Generator)
            function SeededRandom(seed) {
                this.seed = seed % 2147483647;
                if (this.seed <= 0) this.seed += 2147483646;
            }
            
            SeededRandom.prototype.next = function() {
                this.seed = this.seed * 16807 % 2147483647;
                return (this.seed - 1) / 2147483646;
            };
            
            // Get page number from various possible sources
            function getPageNumber() {
                // Method 1: Find which page element contains this footer
                const scriptElement = document.currentScript;
                const footer = scriptElement ? scriptElement.closest('footer') : null;
                
                if (footer) {
                    const pageElements = document.querySelectorAll('page, .page');
                    for (let i = 0; i < pageElements.length; i++) {
                        if (pageElements[i].contains(footer)) {
                            return i + 1;
                        }
                    }
                }
                
                // Method 2: Count existing mountain containers to determine page
                const mountainContainers = document.querySelectorAll('[data-mountain-container="true"]');
                let currentIndex = 0;
                for (let i = 0; i < mountainContainers.length; i++) {
                    if (mountainContainers[i].closest('footer') === footer) {
                        currentIndex = i;
                        break;
                    }
                }
                return currentIndex + 1;
            }
            
            function generateRandomMountains() {
                // Find the container for this specific script instance
                const scriptElement = document.currentScript;
                const footer = scriptElement ? scriptElement.closest('footer') : null;
                const container = footer ? footer.querySelector('[data-mountain-container="true"]') : null;
                
                if (!container) {
                    console.warn('Mountains Random Footer: Could not find container');
                    return;
                }
                
                // Get seed from template data or use page-based seed
                const customSeed = {{#if customSeed}}{{customSeed}}{{else}}null{{/if}};
                const pageNumber = getPageNumber();
                
                let baseSeed;
                if (customSeed !== null) {
                    // Use custom seed + page number for variation per page
                    baseSeed = parseInt(customSeed) + pageNumber * 1000;
                } else {
                    // Use default page-based seed
                    baseSeed = pageNumber * 12345 + 67890;
                }
                
                const rng = new SeededRandom(baseSeed);
                
                // Create more realistic mountain ranges with better spacing
                const pageWidth = 19; // A4 width minus margins in cm
                const minMountainSpacing = 1.5; // Minimum space between mountain peaks
                
                // Two main colors for 50/50 distribution
                const primaryColors = [
                    'var(--highlight-color)',
                    'var(--right-text-color)'
                ];
                
                // Generate mountain ranges instead of individual mountains
                const numRanges = Math.floor(rng.next() * 2) + 2; // 2-3 mountain ranges
                const ranges = [];
                
                for (let rangeIndex = 0; rangeIndex < numRanges; rangeIndex++) {
                    // Each range has 2-4 connected mountains
                    const mountainsInRange = Math.floor(rng.next() * 3) + 2; // 2-4 mountains per range
                    const rangeStartPos = (pageWidth / numRanges) * rangeIndex + rng.next() * 2; // Distribute ranges across page
                    const baseHeight = rng.next() * 1.0 + 0.8; // Base height for this range: 0.8-1.8cm
                    const baseOpacity = rng.next() * 0.3 + 0.5; // 0.5-0.8 opacity per range
                    
                    for (let i = 0; i < mountainsInRange; i++) {
                        // Position mountains within the range with proper spacing
                        const positionInRange = (i / (mountainsInRange - 1)) * (pageWidth / numRanges * 0.8); // 80% of range width
                        const position = rangeStartPos + positionInRange + (rng.next() - 0.5) * 0.5; // Small random offset
                        
                        // Vary height within the range to create realistic peaks
                        const heightVariation = (rng.next() - 0.5) * 0.6; // Â±0.3cm variation
                        const height = Math.max(0.4, baseHeight + heightVariation); // Minimum 0.4cm height
                        
                        // Width varies more naturally
                        const width = rng.next() * 1.5 + 0.6; // 0.6-2.1cm width
                        
                        // Slight opacity variation within range
                        const opacity = baseOpacity + (rng.next() - 0.5) * 0.1;
                        
                        // 50/50 color selection for each mountain
                        const colorIndex = rng.next() < 0.5 ? 0 : 1;
                        const selectedColor = primaryColors[colorIndex];
                        
                        // Create layering effect with z-index
                        const zIndex = rangeIndex + 1 + Math.floor(rng.next() * 2); // Layer ranges with some overlap
                        
                        const mountain = document.createElement('div');
                        mountain.className = `mountain mountains-random-${rangeIndex}-${i}`;
                        mountain.style.cssText = `
                            position: absolute;
                            bottom: 0;
                            left: ${Math.max(0, Math.min(pageWidth - width, position))}cm;
                            width: 0;
                            height: 0;
                            border-left: ${width}cm solid transparent;
                            border-right: ${width}cm solid transparent;
                            border-bottom: ${height}cm solid ${selectedColor};
                            opacity: ${Math.max(0.3, Math.min(0.9, opacity))};
                            z-index: ${zIndex};
                        `;
                        
                        container.appendChild(mountain);
                        ranges.push({ position, width, height, range: rangeIndex, color: colorIndex });
                    }
                }
                
                // Debug info for development
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    const totalMountains = ranges.length;
                    const seedInfo = customSeed !== null ? `custom seed ${customSeed}` : 'page-based seed';
                    console.log(`Mountains Random Footer: Generated ${numRanges} ranges with ${totalMountains} mountains for page ${pageNumber} using ${seedInfo} (final seed: ${baseSeed})`);
                }
            }
            
            // Generate mountains immediately since script is inline
            generateRandomMountains();
        })();
    </script>
</footer>
</body>
</html>